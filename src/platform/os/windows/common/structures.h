// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#ifndef QOR_PP_H_OS_WINDOWS_COMMON_STRUCTURES
#define QOR_PP_H_OS_WINDOWS_COMMON_STRUCTURES

struct ImageDOSHeader
{												// DOS .EXE header
    unsigned short e_magic;                     // Magic number
    unsigned short e_cblp;                      // Bytes on last page of file
    unsigned short e_cp;                        // Pages in file
    unsigned short e_crlc;                      // Relocations
    unsigned short e_cparhdr;                   // Size of header in paragraphs
    unsigned short e_minalloc;                  // Minimum extra paragraphs needed
    unsigned short e_maxalloc;                  // Maximum extra paragraphs needed
    unsigned short e_ss;                        // Initial (relative) SS value
    unsigned short e_sp;                        // Initial SP value
    unsigned short e_csum;                      // Checksum
    unsigned short e_ip;                        // Initial IP value
    unsigned short e_cs;                        // Initial (relative) CS value
    unsigned short e_lfarlc;                    // File address of relocation table
    unsigned short e_ovno;                      // Overlay number
    unsigned short e_res[4];                    // Reserved words
    unsigned short e_oemid;                     // OEM identifier (for e_oeminfo)
    unsigned short e_oeminfo;                   // OEM information; e_oemid specific
    unsigned short e_res2[10];                  // Reserved words
    long e_lfanew;								// File address of new exe header
};

#ifdef __MINGW32__
#	define __ImageBase _image_base__
#endif

namespace qor{ namespace platform { namespace nswindows {

    typedef union _LARGE_INTEGER {
        struct {
            unsigned long LowPart;
            long HighPart;
        } DUMMYSTRUCTNAME;
        struct {
            unsigned long LowPart;
            long HighPart;
        } u;
        __int64 QuadPart;
    } LARGE_INTEGER;

    typedef union _FileSegmentElement 
    {
        void*__ptr64 Buffer;
        unsigned long long Alignment;
    }FileSegmentElement;

#if qor_pp_unicode
    typedef wchar_t TCHAR;   
#   define qor_pp_text(quote) L##quote
#else
    typedef char TCHAR;
#   define qor_pp_text(quote) quote
#endif 

    typedef enum _FileInfoByHandleClass
    {
        FileBasicInfo,
        FileStandardInfo,
        FileNameInfo,
        FileRenameInfo,
        FileDispositionInfo,
        FileAllocationInfo,
        FileEndOfFileInfo,
        FileStreamInfo,
        FileCompressionInfo,
        FileAttributeTagInfo,
        FileIdBothDirectoryInfo,
        FileIdBothDirectoryRestartInfo,
        FileIoPriorityHintInfo,
        FileRemoteProtocolInfo,
        FileFullDirectoryInfo,
        FileFullDirectoryRestartInfo,
        FileStorageInfo,
        FileAlignmentInfo,
        FileIdInfo,
        FileIdExtdDirectoryInfo,
        FileIdExtdDirectoryRestartInfo,
        FileDispositionInfoEx,
        FileRenameInfoEx,
        FileCaseSensitiveInfo,
        FileNormalizedNameInfo,
        MaximumFileInfoByHandleClass
    } FileInfoByHandleClass;

    #define FileInvalidFileID               ((long long)-1LL) 
    typedef struct _FileID128
    {
        unsigned char Identifier[16];                                   
    } FileID128;

    typedef struct _GUID 
    {
        unsigned long  Data1;
        unsigned short Data2;
        unsigned short Data3;
        unsigned char  Data4[ 8 ];
    } GUID;

    enum FileIdType {
        FileType,
        ObjectType,
        ExtendedFileType,
        MaximumFileType
    };

    typedef struct FileIDDescriptor 
    {
        unsigned long size;  // Size of the struct
        FileIdType Type; // Describes the type of identifier passed in.
        union {
            LARGE_INTEGER FileId;
            GUID ObjectId;
            FileID128 ExtendedFileId;
        } DUMMYUNIONNAME;
    } FileIDDescriptor;

    constexpr int OFS_MaxPathName = 128;
    typedef struct _OFStruct
    {
        unsigned char cBytes;
        unsigned char fFixedDisk;
        unsigned short nErrCode;
        unsigned short Reserved1;
        unsigned short Reserved2;
        char szPathName[OFS_MaxPathName];
    } OFStruct;

    typedef struct _FileTime 
    {
        unsigned long lowDateTime;
        unsigned long highDateTime;
    } FileTime;

    typedef struct _ByHandleFileInformation
    {
        unsigned long fileAttributes;
        FileTime ftCreationTime;
        FileTime ftLastAccessTime;
        FileTime ftLastWriteTime;
        unsigned long volumeSerialNumber;
        unsigned long fileSizeHigh;
        unsigned long fileSizeLow;
        unsigned long numberOfLinks;
        unsigned long fileIndexHigh;
        unsigned long fileIndexLow;
    } ByHandleFileInformation;

    struct DisplayDevice
    {
        unsigned long  cb;
        TCHAR  DeviceName[32];
        TCHAR  DeviceString[128];
        unsigned long  StateFlags;
        TCHAR  DeviceID[128];
        TCHAR  DeviceKey[128];
    };

    constexpr int CchFormName = 32;
    constexpr int CchDeviceName = 32;

    struct PointL
    {
        long  x;
        long  y;
    };

    struct DeviceMode 
    {
        TCHAR  dmDeviceName[CchDeviceName];
        unsigned short dmSpecVersion;
        unsigned short dmDriverVersion;
        unsigned short dmSize;
        unsigned short dmDriverExtra;
        unsigned long dmFields;
        union 
        {
            //printer only fields
            struct 
            {
                short dmOrientation;
                short dmPaperSize;
                short dmPaperLength;
                short dmPaperWidth;
                short dmScale;
                short dmCopies;
                short dmDefaultSource;
                short dmPrintQuality;
            } DUMMYSTRUCTNAME;
            // display only fields
            struct 
            {
                PointL dmPosition;
                unsigned long  dmDisplayOrientation;
                unsigned long  dmDisplayFixedOutput;
            } DUMMYSTRUCTNAME2;
        } DUMMYUNIONNAME;
        short dmColor;
        short dmDuplex;
        short dmYResolution;
        short dmTTOption;
        short dmCollate;
        TCHAR  dmFormName[CchFormName];
        unsigned short   dmLogPixels;
        unsigned long  dmBitsPerPel;
        unsigned long  dmPelsWidth;
        unsigned long  dmPelsHeight;
        union 
        {
            unsigned long  dmDisplayFlags;
            unsigned long  dmNup;
        } DUMMYUNIONNAME2;
        unsigned long  dmDisplayFrequency;    
        unsigned long  dmICMMethod;
        unsigned long  dmICMIntent;
        unsigned long  dmMediaType;
        unsigned long  dmDitherType;
        unsigned long  dmReserved1;
        unsigned long  dmReserved2;
        unsigned long  dmPanningWidth;
        unsigned long  dmPanningHeight;
    };
    
    struct XForm
    {
        float   eM11;
        float   eM12;
        float   eM21;
        float   eM22;
        float   eDx;
        float   eDy;
    };

    struct DrawTextParams
    {
        unsigned int    cbSize;
        int             iTabLength;
        int             iLeftMargin;
        int             iRightMargin;
        unsigned int    uiLengthDrawn;
    };

}}}//qor::platform::nswindows

#endif//QOR_PP_H_OS_WINDOWS_COMMON_STRUCTURES