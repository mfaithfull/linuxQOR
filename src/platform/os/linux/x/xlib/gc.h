// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#include <string>
#include <format>
#include <vector>

#include "pixmap.h"

namespace qor{ namespace platform { namespace nslinux{ namespace x{

    /*GC attribute value mask bits
    #define GCFunction (1L<<0)
    #define GCPlaneMask (1L<<1)
    #define GCForeground (1L<<2)
    #define GCBackground (1L<<3)
    #define GCLineWidth (1L<<4)
    #define GCLineStyle (1L<<5)
    #define GCCapStyle (1L<<6)
    #define GCJoinStyle (1L<<7)
    #define GCFillStyle (1L<<8)
    #define GCFillRule (1L<<9)
    #define GCTile (1L<<10)
    #define GCStipple (1L<<11)
    #define GCTileStipXOrigin (1L<<12)
    #define GCTileStipYOrigin (1L<<13)
    #define GCFont (1L<<14)
    #define GCSubwindowMode (1L<<15)
    #define GCGraphicsExposures (1L<<16)
    #define GCClipXOrigin (1L<<17)
    #define GCClipYOrigin (1L<<18)
    #define GCClipMask (1L<<19)
    #define GCDashOffset (1L<<20)
    #define GCDashList (1L<<21)
    #define GCArcMode (1L<<22*/
    struct qor_pp_module_interface(QOR_LINX) GCValues
    {
        int function;		/* logical operation */
        unsigned long plane_mask;/* plane mask */
        unsigned long foreground;/* foreground pixel */
        unsigned long background;/* background pixel */
        int line_width;		/* line width */
        int line_style;	 	/* LineSolid, LineOnOffDash, LineDoubleDash */
        int cap_style;	  	/* CapNotLast, CapButt, CapRound, CapProjecting */
        int join_style;	 	/* JoinMiter, JoinRound, JoinBevel */
        int fill_style;	 	/* FillSolid, FillTiled, FillStippled, FillOpaeueStippled */
        int fill_rule;	  	/* EvenOddRule, WindingRule */
        int arc_mode;		/* ArcChord, ArcPieSlice */
        unsigned long tile;		/* tile pixmap for tiling operations */
        unsigned long stipple;		/* stipple 1 plane pixmap for stipping */
        int ts_x_origin;	/* offset for tile or stipple operations */
        int ts_y_origin;
        unsigned long font;	        /* default text font for text operations */
        int subwindow_mode;     /* ClipByChildren, IncludeInferiors */
        int graphics_exposures;/* boolean, should exposures be generated */
        int clip_x_origin;	/* origin for clipping */
        int clip_y_origin;
        unsigned long clip_mask;	/* bitmap clipping; other calls for rects */
        int dash_offset;	/* patterned/dashed line information */
        char dashes;
    };

    struct Rectangle
    {
        short x;
        short y;
        unsigned short width;
        unsigned short height;
    };

    struct Point
    {
        short x, y;
    };

    struct Arc
    {
        short x, y;
        unsigned short width, height;
        short angle1, angle2;
    };

    struct Char2b;

    struct TextItem16
    {
        Char2b *chars;		// two byte characters
        int nchars;			// number of characters
        int delta;			// delta between strings
        unsigned long font;	// font to print it in, None don't change
    };

    struct TextItem
    {
        char* chars;		// pointer to string
        int nchars;			// number of characters
        int delta;			// delta between strings
        unsigned long font; // font to print it in, None don't change
    };

    struct Segment
    {
        short x1, y1, x2, y2;
    };

    class qor_pp_module_interface(QOR_LINX) Display;
    class qor_pp_module_interface(QOR_LINX) Window;

    class qor_pp_module_interface(QOR_LINX) GC
    {
    public:

        GC() = default;
        GC(Display* display, Window* window, void* gc);
        GC(Display* display, void* gc);
        virtual ~GC();

        void* Use();
        unsigned long GetID();
        void Flush();
        int Copy(GC& dest, unsigned long valuemask);
        int Change(unsigned long valueMask, GCValues& values);
        int GetValues(unsigned long valueMask, GCValues& valuesReturn);
        int SetState(unsigned long foreground, unsigned long background, int function, unsigned long plane_mask);
        int SetForeground(unsigned long foreground);
        int SetBackground(unsigned long background);
        int SetFunction(int function);
        int SetPlaneMask(unsigned long plane_mask);
        int SetLineAttributes(unsigned int line_width, int line_style, int cap_style, int join_style);
        int SetDashes(int dash_offset, const char* dash_list, int n);
        int SetFillStyle(int fill_style);
        int SetFillRule(int fill_rule);
        int SetTile(Pixmap& tile);
        int SetStipple(Pixmap& stipple);
        int SetTSOrigin(int ts_x_origin, int ts_y_origin);
        int SetFont(unsigned long font);
        int SetClipOrigin(int clip_x_origin, int clip_y_origin);
        int SetClipMask(Pixmap& pixmap);
        int SetClipRectangles(int clip_x_origin, int clip_y_origin, Rectangle rectangles[], int n, int ordering);
        int SetArcMode(int arc_mode);
        int SetSubWindowMode(int subwindow_mode);
        int SetGraphicsExposures(int graphics_exposures);
        int PutImage(unsigned long drawableTarget, void* image, int srcX, int srcY, int destX, int destY, unsigned int width, unsigned int height);
        int FillRectangles(unsigned long drawableTarget, std::vector<Rectangle>& rectangles);
        int FillRectangle(unsigned long drawableTarget, int x, int y, unsigned int width, unsigned int height);
        int FillPolygon(unsigned long drawableTarget, std::vector<Point> points, int shape, int mode);
        int FillArcs(unsigned long drawableTarget, std::vector<Arc>& arcs);
        int FillArc(unsigned long drawableTaget, Arc& src);
        int DrawText16(unsigned long drawableTarget, int x, int y, std::vector<TextItem16>& items);
        int DrawText(unsigned long drawableTarget, int x, int y, std::vector<TextItem>& items);
        int DrawString16(unsigned long drawableTarget, int x, int y, std::vector<Char2b>& str);
        int DrawString(unsigned long drawableTarget, int x, int y, std::string& str);
        int DrawSegments(unsigned long drawableTarget, std::vector<Segment>& segments);
        int DrawRectangles(unsigned long drawableTarget, std::vector<Rectangle>& rectangles);
        int DrawRectangle(unsigned long drawableTarget, int x, int y, unsigned int width, unsigned int height);
        int DrawPoint(unsigned long drawableTarget, int x, int y);
        int DrawPoints(unsigned long drawableTarget, std::vector<Point>& points, int mode);
        int DrawLines(unsigned long drawableTarget, std::vector<Point>& points, int mode);
        int DrawLine(unsigned long drawableTarget, int x1, int y1, int x2, int y2);
        int DrawImageString16(unsigned long drawableTarget, int x, int y, std::vector<Char2b>& str);
        int DrawImageString(unsigned long drawableTarget, int x, int y, std::string& str);
        int DrawArcs(unsigned long drawableTarget, std::vector<Arc>& arcs);
        int DrawArc(unsigned long drawableTarget, int x, int y, unsigned int width, unsigned int height, int angle1, int angle2);
        int CopyPlane(unsigned long src, unsigned long dest, int src_x, int src_y, unsigned int width, unsigned int height, int dest_x, int dest_y, unsigned long plane);
        int CopyArea(unsigned long src, unsigned long dest, int src_x, int src_y, unsigned int width, unsigned int height, int dest_x, int dest_y);
        
    private:
        Display* m_display;
        Window* m_window;
        void* m_gc;

        bool m_temporary;
    };

}}}}//qor::platform::nslinux::x
