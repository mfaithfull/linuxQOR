// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#ifndef QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_REQUESTGENERATOR_STATE
#define QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_REQUESTGENERATOR_STATE

#include <iostream>
#include <string>
#include "src/platform/compiler/compiler.h"
#include "src/framework/thread/currentthread.h"
#include "src/qor/reference/newref.h"
#include "src/framework/workflow/workflow.h"
#include "src/platform/architecture/detectarchitecture.h"

namespace qor { namespace components { namespace protocols { namespace http {
    
    class qor_pp_module_interface(QOR_HTTP) HTTPRequestGenerator;
    
    class qor_pp_module_interface(QOR_HTTP) RequestGenState : public qor::workflow::State
    {
    public:

        RequestGenState(HTTPRequestGenerator* generator);
        virtual ~RequestGenState() = default;

    protected:

        class Context* GetContext();
        workflow::Workflow* Workflow();
        HTTPRequestGenerator* GetRequestGenerator();
        
        byte* m_data;
        size_t m_index;
        size_t m_size;
        
    };

    class qor_pp_module_interface(QOR_HTTP) RequestGenInitial : public RequestGenState
    {
    public:

        RequestGenInitial(HTTPRequestGenerator* generator);
        virtual ~RequestGenInitial() = default;
    };

    class RequestGenTrailers : public RequestGenState
    {
    public:

        RequestGenTrailers(HTTPRequestGenerator* generator);
        virtual ~RequestGenTrailers() = default;
    };

    class RequestGenBody : public RequestGenState
    {
    public:

        RequestGenBody(HTTPRequestGenerator* generator);
        virtual ~RequestGenBody() = default;
    };

    class RequestGenHeaders : public RequestGenState
    {
    public:

        RequestGenHeaders(HTTPRequestGenerator* generator);
        virtual ~RequestGenHeaders() = default;
    };

    class RequestGenLine : public RequestGenState
    {
    public:

        RequestGenLine(HTTPRequestGenerator* generator);
        virtual ~RequestGenLine() = default;
    };

    class RequestGenVersion : public RequestGenState
    {
    public:

        RequestGenVersion(HTTPRequestGenerator* generator);
        virtual ~RequestGenVersion() = default;
    };

    class RequestGenURI : public RequestGenState
    {
    public:

        RequestGenURI(HTTPRequestGenerator* generator);
        virtual ~RequestGenURI() = default;
    };

    class RequestGenMethod : public RequestGenState
    {
    public:

        RequestGenMethod(HTTPRequestGenerator* generator);
        virtual ~RequestGenMethod() = default;
    };

    class RequestGenCRLF : public RequestGenState
    {
    public:

        RequestGenCRLF(HTTPRequestGenerator* generator);
        virtual ~RequestGenCRLF() = default;
    };

    class RequestGenString : public RequestGenState
    {
    public:

        RequestGenString(HTTPRequestGenerator* generator, std::string str);
        virtual ~RequestGenString() = default;

    private:

        std::string::iterator m_it;
        std::string m_str;
    };

    class RequestGenChar : public RequestGenState
    {
    public:

        RequestGenChar(HTTPRequestGenerator* generator, byte character);
        virtual ~RequestGenChar() = default;
    };

    //TODO: Start with Char and then String then build up Request line and test it in combination with the request parser

    //RequestLine
        //Method
            //String
        //SP
            //Char
        //Request-URI
            //String
        //SP
            //Char
        //HTTP-Version
            //String &| Char
        //CRLF
            //Char
    //Headers
        //* Header
            //(General-Header | Request-Header | Entity-Header) CRLF
            //Request-Header
                //Accept |
                //Accept-Charset |
                //Accept-Encoding |
                //Accept-Language |
                //Authorization |
                //Expect |
                //From |
                //Host |
                //If-Match |
                //If-Modified-Since |
                //If-None-Match |
                //If-Range |
                //If-Unmodified-Since |
                //Max-Forwards
                //Proxy-Authorization |
                //Range
                //Referer
                //TE
                //User-Agent
        //CRLF
    //Body
    //Trailers (basically the same logic as headers)

    /*Accept         = "Accept" ":"
                        #( media-range [ accept-params ] )

       media-range    = ( "* / *"           #Without spaces
                        | ( type "/" "*" )
                        | ( type "/" subtype )
                        ) *( ";" parameter )
       accept-params  = ";" "q" "=" qvalue *( accept-extension )
       accept-extension = ";" token [ "=" ( token | quoted-string ) ]
    */
}}}}//qor::components::protocols::http

#endif//QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_REQUESTGENERATOR_STATE