// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#ifndef QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_RESPONSEGENERATOR_STATE
#define QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_RESPONSEGENERATOR_STATE

#include <iostream>
#include <string>
#include "src/platform/compiler/compiler.h"
#include "src/framework/thread/currentthread.h"
#include "src/qor/reference/newref.h"
#include "src/framework/workflow/workflow.h"
#include "src/components/parser/context.h"

namespace qor { namespace components { namespace protocols { namespace http {
    
    class qor_pp_module_interface(QOR_HTTP) HTTPResponseGenerator;
    
    class qor_pp_module_interface(QOR_HTTP) ResponseGenState : public qor::workflow::State
    {
    public:

        ResponseGenState(HTTPResponseGenerator* generator);
        virtual ~ResponseGenState() = default;

    protected:

        parser::Context* GetContext();
        workflow::Workflow* Workflow();
        HTTPResponseGenerator* GetResponseGenerator();
    };

    class qor_pp_module_interface(QOR_HTTP) ResponseGenInitial : public ResponseGenState
    {
    public:

        ResponseGenInitial(HTTPResponseGenerator* generator);
        virtual ~ResponseGenInitial() = default;
    };

    class ResponseGenCRLF : public ResponseGenState
    {
    public:

        ResponseGenCRLF(HTTPResponseGenerator* generator);
        virtual ~ResponseGenCRLF() = default;

    private:
        bool m_EnteredAtLeastOnce;
    };

    class ResponseGenString : public ResponseGenState
    {
    public:

        ResponseGenString(HTTPResponseGenerator* generator, std::string str);
        virtual ~ResponseGenString() = default;

    private:

        std::string::iterator m_it;
        std::string m_str;
        bool m_EnteredAtLeastOnce;
    };

    class ResponseGenChar : public ResponseGenState
    {
    public:

        ResponseGenChar(HTTPResponseGenerator* generator, byte character);
        virtual ~ResponseGenChar() = default;

    private:

        bool m_EnteredAtLeastOnce;
    };

    //RequestLine
        //Method
            //String
        //SP
            //Char
        //Request-URI
            //String
        //SP
            //Char
        //HTTP-Version
            //String &| Char
        //CRLF
            //Char
    //Headers
        //* Header
            //(General-Header | Request-Header | Entity-Header) CRLF
            //General-Header
                //Cache-Control |
                //Connection |
                //Date |
                //Pragma |
                //Trailer |
                //Transfer-Encoding |
                //Upgrade |
                //Via |
                //Warning |
            //Request-Header
                //Accept |
                //Accept-Charset |
                //Accept-Encoding |
                //Accept-Language |
                //Authorization |
                //Expect |
                //From |
                //Host |
                //If-Match |
                //If-Modified-Since |
                //If-None-Match |
                //If-Range |
                //If-Unmodified-Since |
                //Max-Forwards
                //Proxy-Authorization |
                //Range
                //Referer
                //TE
                //User-Agent
            //entity-header
                //Allow |
                //Content-Encoding |
                //Content-Language |
                //Content-Length |
                //Content-Location |
                //Content-MD5 |
                //Content-Range |
                //Content-Type |
                //Expires |
                //Last-Modified |
                //extension-header |
                    //message-header
                        //field-name ":" [ field-value ]
                        //field-name     = token
                        //field-value    = *( field-content | LWS )
                        //field-content  = <the OCTETs making up the field-value and consisting of either *TEXT or combinations of token, separators, and quoted-string>
        //CRLF
    //Body
    //Trailers (basically the same logic as headers)

    /*Accept         = "Accept" ":"
                        #( media-range [ accept-params ] )

       media-range    = ( "* / *"           #Without spaces
                        | ( type "/" "*" )
                        | ( type "/" subtype )
                        ) *( ";" parameter )
       accept-params  = ";" "q" "=" qvalue *( accept-extension )
       accept-extension = ";" token [ "=" ( token | quoted-string ) ]
    */
}}}}//qor::components::protocols::http

#endif//QOR_PP_H_COMPONENTS_PROTOCOLS_HTTP_RESPONSEGENERATOR_STATE