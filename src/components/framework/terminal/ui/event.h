// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#ifndef QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_UI_EVENT
#define QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_UI_EVENT

#include <string>
#include <string_view>

#include "mouse.h"

namespace qor{ namespace components{ namespace tui {

    class qor_pp_module_interface(QOR_TUI) ScreenInteractive;
    class qor_pp_module_interface(QOR_TUI) ComponentBase;

    /// @brief Represent an event. It can be key press event, a terminal resize, or
    ///
    /// For example:
    /// - Printable character can be created using Event::Character('a').
    /// - Some special are predefined, like Event::ArrowLeft.
    /// - One can find arbitrary code for special Events using:
    ///   ./example/util/print_key_press
    ///  For instance, CTLR+A maps to Event::Special({1});
    ///
    /// Useful documentation about xterm specification:
    /// https://invisible-island.net/xterm/ctlseqs/ctlseqs.html
    ///
    struct qor_pp_module_interface(QOR_TUI) Event 
    {
        static Event Character(std::string_view);
        static Event Character(char);
        static Event Character(wchar_t);
        static Event Special(std::string_view);
        static Event Mouse(std::string_view, Mouse mouse);
        static Event CursorPosition(std::string_view, int x, int y);  // Internal
        static Event CursorShape(std::string_view, int shape);        // Internal

        static const Event ArrowLeft;
        static const Event ArrowRight;
        static const Event ArrowUp;
        static const Event ArrowDown;

        static const Event ArrowLeftCtrl;
        static const Event ArrowRightCtrl;
        static const Event ArrowUpCtrl;
        static const Event ArrowDownCtrl;

        // --- Other ---
        static const Event Backspace;
        static const Event Delete;
        static const Event Return;
        static const Event Escape;
        static const Event Tab;
        static const Event TabReverse;

        // --- Navigation keys ---
        static const Event Insert;
        static const Event Home;
        static const Event End;
        static const Event PageUp;
        static const Event PageDown;

        // --- Function keys ---
        static const Event F1;
        static const Event F2;
        static const Event F3;
        static const Event F4;
        static const Event F5;
        static const Event F6;
        static const Event F7;
        static const Event F8;
        static const Event F9;
        static const Event F10;
        static const Event F11;
        static const Event F12;

        // --- Control keys ---
        static const Event a;
        static const Event A;
        static const Event CtrlA;
        static const Event AltA;
        static const Event CtrlAltA;
        static const Event b; 
        static const Event B; 
        static const Event CtrlB;
        static const Event AltB;
        static const Event CtrlAltB;
        static const Event c;
        static const Event C;
        static const Event CtrlC;
        static const Event AltC;
        static const Event CtrlAltC;
        static const Event d;
        static const Event D;
        static const Event CtrlD;
        static const Event AltD;
        static const Event CtrlAltD;
        static const Event e;
        static const Event E;
        static const Event CtrlE;
        static const Event AltE;
        static const Event CtrlAltE;
        static const Event f;
        static const Event F;
        static const Event CtrlF;
        static const Event AltF;
        static const Event CtrlAltF;
        static const Event g;
        static const Event G;
        static const Event CtrlG;
        static const Event AltG;
        static const Event CtrlAltG;
        static const Event h;
        static const Event H;
        static const Event CtrlH;
        static const Event AltH;
        static const Event CtrlAltH;
        static const Event i;
        static const Event I;
        static const Event CtrlI;
        static const Event AltI;
        static const Event CtrlAltI;
        static const Event j;
        static const Event J;
        static const Event CtrlJ;
        static const Event AltJ;
        static const Event CtrlAltJ;
        static const Event k;
        static const Event K;
        static const Event CtrlK;
        static const Event AltK;
        static const Event CtrlAltK;
        static const Event l;
        static const Event L;
        static const Event CtrlL;
        static const Event AltL;
        static const Event CtrlAltL;
        static const Event m;
        static const Event M;
        static const Event CtrlM;
        static const Event AltM;
        static const Event CtrlAltM;
        static const Event n;
        static const Event N;
        static const Event CtrlN;
        static const Event AltN;
        static const Event CtrlAltN;
        static const Event o;
        static const Event O;
        static const Event CtrlO;
        static const Event AltO;
        static const Event CtrlAltO;
        static const Event p;
        static const Event P;
        static const Event CtrlP;
        static const Event AltP;
        static const Event CtrlAltP;
        static const Event q;
        static const Event Q;
        static const Event CtrlQ;
        static const Event AltQ;
        static const Event CtrlAltQ;
        static const Event r;
        static const Event R;
        static const Event CtrlR;
        static const Event AltR;
        static const Event CtrlAltR;
        static const Event s;
        static const Event S;
        static const Event CtrlS;
        static const Event AltS;
        static const Event CtrlAltS;
        static const Event t;
        static const Event T;
        static const Event CtrlT;
        static const Event AltT;
        static const Event CtrlAltT;
        static const Event u;
        static const Event U;
        static const Event CtrlU;
        static const Event AltU;
        static const Event CtrlAltU;
        static const Event v;
        static const Event V;
        static const Event CtrlV;
        static const Event AltV;
        static const Event CtrlAltV;
        static const Event w;
        static const Event W;
        static const Event CtrlW;
        static const Event AltW;
        static const Event CtrlAltW;
        static const Event x;
        static const Event X;
        static const Event CtrlX;
        static const Event AltX;
        static const Event CtrlAltX;
        static const Event y;
        static const Event Y;
        static const Event CtrlY;
        static const Event AltY;
        static const Event CtrlAltY;
        static const Event z;
        static const Event Z;
        static const Event CtrlZ;
        static const Event AltZ;
        static const Event CtrlAltZ;

        // --- Custom ---
        static const Event Custom;

        bool operator==(const Event& other) const { return input_ == other.input_; }
        bool operator!=(const Event& other) const { return !operator==(other); }
        bool operator<(const Event& other) const { return input_ < other.input_; }

        const std::string& input() const { return input_; }

        bool is_character() const { return type_ == Type::Character; }
        std::string character() const { return input_; }

        bool is_mouse() const { return type_ == Type::Mouse; }
        struct Mouse& mouse() { return data_.mouse; }

        // --- Internal Method section -----------------------------------------------
        bool is_cursor_position() const { return type_ == Type::CursorPosition; }
        int cursor_x() const { return data_.cursor.x; }
        int cursor_y() const { return data_.cursor.y; }

        bool is_cursor_shape() const { return type_ == Type::CursorShape; }
        int cursor_shape() const { return data_.cursor_shape; }

        // Debug
        std::string DebugString() const;

        //--- State section ----------------------------------------------------------
        ScreenInteractive* screen_ = nullptr;

        private:
        friend ComponentBase;
        friend ScreenInteractive;
        enum class Type 
        {
            Unknown,
            Character,
            Mouse,
            CursorPosition,
            CursorShape,
        };
        Type type_ = Type::Unknown;

        struct Cursor 
        {
            int x = 0;
            int y = 0;
        };

        union 
        {
            struct Mouse mouse;
            struct Cursor cursor;
            int cursor_shape;
        } data_ = {};

        std::string input_;
    };

}}}//qor::components::tui

#endif//QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_UI_EVENT

