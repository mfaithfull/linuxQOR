// Copyright Querysoft Limited 2008 - 2025
//
// Permission is hereby granted, free of charge, to any person or organization
// obtaining a copy of the software and accompanying documentation covered by
// this license (the "Software") to use, reproduce, display, distribute,
// execute, and transmit the Software, and to prepare derivative works of the
// Software, and to permit third-parties to whom the Software is furnished to
// do so, all subject to the following:
// 
// The copyright notices in the Software and this entire statement, including
// the above license grant, this restriction and the following disclaimer,
// must be included in all copies of the Software, in whole or in part, and
// all derivative works of the Software, unless such copies or derivative
// works are solely in the form of machine-executable object code generated by
// a source language processor.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
// SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
// FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
// DEALINGS IN THE SOFTWARE.

#ifndef QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_DOM_ELEMENTS
#define QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_DOM_ELEMENTS

#include <functional>
#include <memory>
#include <string_view>

#include "canvas.h"
#include "direction.h"
#include "flexboxconfig.h"
#include "lineargradient.h"
#include "node.h"
#include "../screen/box.h"
#include "../screen/colour.h"
#include "../screen/terminal.h"
//#include "ftxui/util/ref.hpp"

namespace qor{ namespace components{ namespace tui {

    class qor_pp_module_interface(QOR_TUI) Node;
    using Element = std::shared_ptr<Node>;
    using Elements = std::vector<Element>;
    using Decorator = std::function<Element(Element)>;
    using GraphFunction = std::function<std::vector<int>(int, int)>;

    // BorderStyle is an enumeration that represents the different styles of
    // borders that can be applied to elements in the terminal UI.
    // It is used to define the visual appearance of borders around elements,
    // such as windows, frames, or separators.
    
    enum BorderStyle 
    {
        LIGHT,
        DASHED,
        HEAVY,
        DOUBLE,
        ROUNDED,
        EMPTY,
    };

    // Pipe elements into decorator.
    // For instance the next lines are equivalents:
    // -> text("ftxui") | bold | underlined
    // -> underlined(bold(text("FTXUI")))
    qor_pp_module_interface(QOR_TUI) Element operator|(Element, Decorator);
    qor_pp_module_interface(QOR_TUI) Element& operator|=(Element&, Decorator);
    qor_pp_module_interface(QOR_TUI) Elements operator|(Elements, Decorator);
    qor_pp_module_interface(QOR_TUI) Decorator operator|(Decorator, Decorator);

    // --- Widget ---
    qor_pp_module_interface(QOR_TUI) Element text(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element vtext(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element separator();
    qor_pp_module_interface(QOR_TUI) Element separatorLight();
    qor_pp_module_interface(QOR_TUI) Element separatorDashed();
    qor_pp_module_interface(QOR_TUI) Element separatorHeavy();
    qor_pp_module_interface(QOR_TUI) Element separatorDouble();
    qor_pp_module_interface(QOR_TUI) Element separatorEmpty();
    qor_pp_module_interface(QOR_TUI) Element separatorStyled(BorderStyle);
    qor_pp_module_interface(QOR_TUI) Element separator(Pixel);
    qor_pp_module_interface(QOR_TUI) Element separatorCharacter(std::string_view);
    qor_pp_module_interface(QOR_TUI) Element separatorHSelector(float left, float right, Colour unselected_color, Colour selected_color);
    qor_pp_module_interface(QOR_TUI) Element separatorVSelector(float up, float down, Colour unselected_color, Colour selected_color);
    qor_pp_module_interface(QOR_TUI) Element gauge(float progress);
    qor_pp_module_interface(QOR_TUI) Element gaugeLeft(float progress);
    qor_pp_module_interface(QOR_TUI) Element gaugeRight(float progress);
    qor_pp_module_interface(QOR_TUI) Element gaugeUp(float progress);
    qor_pp_module_interface(QOR_TUI) Element gaugeDown(float progress);
    qor_pp_module_interface(QOR_TUI) Element gaugeDirection(float progress, Direction direction);
    qor_pp_module_interface(QOR_TUI) Element border(Element);
    qor_pp_module_interface(QOR_TUI) Element borderLight(Element);
    qor_pp_module_interface(QOR_TUI) Element borderDashed(Element);
    qor_pp_module_interface(QOR_TUI) Element borderHeavy(Element);
    qor_pp_module_interface(QOR_TUI) Element borderDouble(Element);
    qor_pp_module_interface(QOR_TUI) Element borderRounded(Element);
    qor_pp_module_interface(QOR_TUI) Element borderEmpty(Element);
    qor_pp_module_interface(QOR_TUI) Decorator borderStyled(BorderStyle);
    qor_pp_module_interface(QOR_TUI) Decorator borderStyled(BorderStyle, Colour);
    qor_pp_module_interface(QOR_TUI) Decorator borderStyled(Colour);
    qor_pp_module_interface(QOR_TUI) Decorator borderWith(const Pixel&);
    qor_pp_module_interface(QOR_TUI) Element window(Element title, Element content, BorderStyle border = ROUNDED);
    qor_pp_module_interface(QOR_TUI) Element spinner(int charset_index, size_t image_index);
    qor_pp_module_interface(QOR_TUI) Element paragraph(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element paragraphAlignLeft(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element paragraphAlignRight(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element paragraphAlignCenter(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element paragraphAlignJustify(std::string_view text);
    qor_pp_module_interface(QOR_TUI) Element graph(GraphFunction);
    qor_pp_module_interface(QOR_TUI) Element emptyElement();
    qor_pp_module_interface(QOR_TUI) Element canvas(const Canvas&);
    qor_pp_module_interface(QOR_TUI) Element canvas(int width, int height, std::function<void(Canvas&)>);
    qor_pp_module_interface(QOR_TUI) Element canvas(std::function<void(Canvas&)>);

    // -- Decorator ---
    qor_pp_module_interface(QOR_TUI) Element bold(Element);
    qor_pp_module_interface(QOR_TUI) Element dim(Element);
    qor_pp_module_interface(QOR_TUI) Element italic(Element);
    qor_pp_module_interface(QOR_TUI) Element inverted(Element);
    qor_pp_module_interface(QOR_TUI) Element underlined(Element);
    qor_pp_module_interface(QOR_TUI) Element underlinedDouble(Element);
    qor_pp_module_interface(QOR_TUI) Element blink(Element);
    qor_pp_module_interface(QOR_TUI) Element strikethrough(Element);
    qor_pp_module_interface(QOR_TUI) Decorator color(Colour);
    qor_pp_module_interface(QOR_TUI) Decorator bgcolor(Colour);
    qor_pp_module_interface(QOR_TUI) Decorator color(const LinearGradient&);
    qor_pp_module_interface(QOR_TUI) Decorator bgcolor(const LinearGradient&);
    qor_pp_module_interface(QOR_TUI) Element color(Colour, Element);
    qor_pp_module_interface(QOR_TUI) Element bgcolor(Colour, Element);
    qor_pp_module_interface(QOR_TUI) Element color(const LinearGradient&, Element);
    qor_pp_module_interface(QOR_TUI) Element bgcolor(const LinearGradient&, Element);
    qor_pp_module_interface(QOR_TUI) Decorator focusPosition(int x, int y);
    qor_pp_module_interface(QOR_TUI) Decorator focusPositionRelative(float x, float y);
    qor_pp_module_interface(QOR_TUI) Element automerge(Element child);
    qor_pp_module_interface(QOR_TUI) Decorator hyperlink(std::string_view link);
    qor_pp_module_interface(QOR_TUI) Element hyperlink(std::string_view link, Element child);
    qor_pp_module_interface(QOR_TUI) Element selectionStyleReset(Element);
    qor_pp_module_interface(QOR_TUI) Decorator selectionColor(Colour foreground);
    qor_pp_module_interface(QOR_TUI) Decorator selectionBackgroundColor(Colour foreground);
    qor_pp_module_interface(QOR_TUI) Decorator selectionForegroundColor(Colour foreground);
    qor_pp_module_interface(QOR_TUI) Decorator selectionStyle(std::function<void(Pixel&)> style);

    // --- Layout is
    // Horizontal, Vertical or stacked set of elements.
    qor_pp_module_interface(QOR_TUI) Element hbox(Elements);
    qor_pp_module_interface(QOR_TUI) Element vbox(Elements);
    qor_pp_module_interface(QOR_TUI) Element dbox(Elements);
    qor_pp_module_interface(QOR_TUI) Element flexbox(Elements, FlexboxConfig config = FlexboxConfig());
    qor_pp_module_interface(QOR_TUI) Element gridbox(std::vector<Elements> lines);

    qor_pp_module_interface(QOR_TUI) Element hflow(Elements);  // Helper: default flexbox with row direction.
    qor_pp_module_interface(QOR_TUI) Element vflow(Elements);  // Helper: default flexbox with column direction.

    // -- Flexibility ---
    // Define how to share the remaining space when not all of it is used inside a
    // container.
    qor_pp_module_interface(QOR_TUI) Element flex(Element);         // Expand/Minimize if possible/needed.
    qor_pp_module_interface(QOR_TUI) Element flex_grow(Element);    // Expand element if possible.
    qor_pp_module_interface(QOR_TUI) Element flex_shrink(Element);  // Minimize element if needed.

    qor_pp_module_interface(QOR_TUI) Element xflex(Element);         // Expand/Minimize if possible/needed on X axis.
    qor_pp_module_interface(QOR_TUI) Element xflex_grow(Element);    // Expand element if possible on X axis.
    qor_pp_module_interface(QOR_TUI) Element xflex_shrink(Element);  // Minimize element if needed on X axis.

    qor_pp_module_interface(QOR_TUI) Element yflex(Element);         // Expand/Minimize if possible/needed on Y axis.
    qor_pp_module_interface(QOR_TUI) Element yflex_grow(Element);    // Expand element if possible on Y axis.
    qor_pp_module_interface(QOR_TUI) Element yflex_shrink(Element);  // Minimize element if needed on Y axis.

    qor_pp_module_interface(QOR_TUI) Element notflex(Element);  // Reset the flex attribute.
    qor_pp_module_interface(QOR_TUI) Element filler();          // A blank expandable element.

    // -- Size override;
    enum WidthOrHeight { WIDTH, HEIGHT };
    enum Constraint { LESS_THAN, EQUAL, GREATER_THAN };
    qor_pp_module_interface(QOR_TUI) Decorator size(WidthOrHeight, Constraint, int value);

    // --- Frame ---
    // A frame is a scrollable area. The internal area is potentially larger than
    // the external one. The internal area is scrolled in order to make visible the
    // focused element.
    qor_pp_module_interface(QOR_TUI) Element frame(Element);
    qor_pp_module_interface(QOR_TUI) Element xframe(Element);
    qor_pp_module_interface(QOR_TUI) Element yframe(Element);
    qor_pp_module_interface(QOR_TUI) Element focus(Element);
    qor_pp_module_interface(QOR_TUI) Element select(Element e);  // Deprecated - Alias for focus.

    // --- Cursor ---
    // Those are similar to `focus`, but also change the shape of the cursor.
    qor_pp_module_interface(QOR_TUI) Element focusCursorBlock(Element);
    qor_pp_module_interface(QOR_TUI) Element focusCursorBlockBlinking(Element);
    qor_pp_module_interface(QOR_TUI) Element focusCursorBar(Element);
    qor_pp_module_interface(QOR_TUI) Element focusCursorBarBlinking(Element);
    qor_pp_module_interface(QOR_TUI) Element focusCursorUnderline(Element);
    qor_pp_module_interface(QOR_TUI) Element focusCursorUnderlineBlinking(Element);

    // --- Misc ---
    qor_pp_module_interface(QOR_TUI) Element vscroll_indicator(Element);
    qor_pp_module_interface(QOR_TUI) Element hscroll_indicator(Element);
    qor_pp_module_interface(QOR_TUI) Decorator reflect(Box& box);
    // Before drawing the |element| clear the pixel below. This is useful in
    // combinaison with dbox.
    qor_pp_module_interface(QOR_TUI) Element clear_under(Element element);

    // --- Util --------------------------------------------------------------------
    qor_pp_module_interface(QOR_TUI) Element hcenter(Element);
    qor_pp_module_interface(QOR_TUI) Element vcenter(Element);
    qor_pp_module_interface(QOR_TUI) Element center(Element);
    qor_pp_module_interface(QOR_TUI) Element align_right(Element);
    qor_pp_module_interface(QOR_TUI) Element nothing(Element element);

    namespace Dimension 
    {
        qor_pp_module_interface(QOR_TUI) Dimensions Fit(Element&, bool extend_beyond_screen = false);
    }  // namespace Dimension

}}}//qor::components::tui

#include "anyargs.h"

#endif//QOR_PP_H_COMPONENTS_FRAMEWORK_TUI_DOM_ELEMENTS

